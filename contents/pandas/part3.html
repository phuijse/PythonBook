

<!DOCTYPE html>


<html lang="es" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>11. Operaciones avanzadas con DataFrames &#8212; Computación Científica con Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/pandas/part3';</script>
    <link rel="index" title="Índice" href="../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../search.html" />
    <link rel="next" title="12. Tópicos extra" href="part4.html" />
    <link rel="prev" title="10. Importar y exportar datos" href="part2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Saltar al contenido principal</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../README.html">
  
  
  
  
  
    <p class="title logo__title">Computación Científica con Python</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introducción</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../preliminaries/intro.html">1. Computación científica y ciencia de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preliminaries/python3.html">2. Repaso de Python 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preliminaries/env_management.html">3. Administración de ambientes y librerías</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preliminaries/git.html">4. Control de versiones</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Ambiente jupyter</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../jupyter/intro.html">5. ¿Qué es Jupyter?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/tutorial.html">6. Breve tutorial de Jupyter y IPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/ipython_display.html">7. Módulo  <code class="docutils literal notranslate"><span class="pre">IPython.display</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/beyond_python.html">8. Otros lenguajes en Jupyter</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Análisis de datos con Pandas</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="part1.html">9. DataFrames de <code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="part2.html">10. Importar y exportar datos</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">11. Operaciones avanzadas con DataFrames</a></li>
<li class="toctree-l1"><a class="reference internal" href="part4.html">12. Tópicos extra</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualización de datos con Matplotlib</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../visualization/matplotlib1.html">13. Introducción a Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/matplotlib2.html">14. Tipos de gráfico en matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/goodvisualizations.html">15. ¿Cómo hacer buenas visualizaciones?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization/ipywidgets.html">16. Interfaces de usuario en Jupyter con <code class="docutils literal notranslate"><span class="pre">ipywidgets</span></code></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Matemática computacional con Numpy y Scipy</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../numpy/numpy1.html">17. Arreglos n-dimensionales con NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../numpy/numpy2.html">18. Operaciones sobre ndarrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linalg/intro.html">19. Intuiciones geométricas de álgeba lineal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linalg/linalg1.html">20. Resolviendo sistemas de ecuaciones lineales</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linalg/eigvals.html">21. Problema de los valores y vectores propios</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calculus/optimization.html">22. Optimización matemática</a></li>
<li class="toctree-l1"><a class="reference internal" href="../calculus/ode_integration.html">23. Ecuaciones Diferenciales Ordinarias</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Estadística con Scipy</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../statistics/intro.html">24. Introducción y fundamentos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/distributions.html">25. Distribuciones de probabilidad</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/descriptive.html">26. Estadística descriptiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/model_fitting.html">27. Estadística inferencial: Ajuste de Modelos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/hypothesis.html">28. Test de hipótesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/bootstrap.html">29. Intervalos de confianza con <em>Bootstrap</em></a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Aprendizaje de máquinas con Scikit-Learn</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sklearn/intro.html">30. Machine Learning: Conceptos clave</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sklearn/pca.html">31. Reducción de dimensionalidad con PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sklearn/kmeans.html">32. Clustering con algoritmo K-means</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sklearn/naivebayes.html">33. Clasificador Bayesiano “Ingenuo”</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sklearn/metrics.html">34. Evaluando un clasificador</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Alto rendimiento en Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../hpc/intro.html">35. Python y  Rendimiento</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc/profiling.html">36. Perfilado (Profiling) de rutinas de Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc/python.html">37. Optimizando código Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc/vectorization.html">38. Vectorización: Cómputo basado en arreglos con NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc/cython.html">39. Acelerando Python con Cython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc/parallel.html">40. Computación paralela en Python</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/phuijse/PythonBook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Repositorio de origen"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/phuijse/PythonBook/issues/new?title=Issue%20on%20page%20%2Fcontents/pandas/part3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Abrir un problema"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/contents/pandas/part3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Operaciones avanzadas con DataFrames</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-indices">11.1. Multi-índices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patron-split-apply-combine-en-dataframes">11.2. Patrón <em>Split-Apply-Combine</em> en DataFrames</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributo-groupby">11.2.1. Atributo <code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-con-aggregate">11.2.2. Reducción con <code class="docutils literal notranslate"><span class="pre">aggregate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtrado-con-filter">11.2.3. Filtrado con <code class="docutils literal notranslate"><span class="pre">filter</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modificando-el-dataframe-con-transform">11.2.4. Modificando el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> con <code class="docutils literal notranslate"><span class="pre">transform</span></code></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="operaciones-avanzadas-con-dataframes">
<h1><span class="section-number">11. </span>Operaciones avanzadas con DataFrames<a class="headerlink" href="#operaciones-avanzadas-con-dataframes" title="Permalink to this heading">#</a></h1>
<p>Contenidos de esta lección</p>
<ul class="simple">
<li><p>Creación de DataFrames con índices jerárquicos: <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></p></li>
<li><p>Patrón Split-Apply-Combine con <code class="docutils literal notranslate"><span class="pre">groupBy</span></code></p></li>
</ul>
<p>Consideremos la siguiente tabla de la lección anterior con los datos del Censo 2017 de Chile</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;censo.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NOMBRE REGIÓN</th>
      <th>Código Región</th>
      <th>NOMBRE PROVINCIA</th>
      <th>Código Provincia</th>
      <th>NOMBRE COMUNA</th>
      <th>Código Comuna</th>
      <th>Viviendas Particulares Ocupadas con Moradores Presentes</th>
      <th>Viviendas Particulares Ocupadas con Moradores Ausentes</th>
      <th>Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)</th>
      <th>Viviendas Particulares Desocupadas\n(de Temporada)</th>
      <th>Viviendas Colectivas</th>
      <th>TOTAL VIVIENDAS</th>
    </tr>
    <tr>
      <th>ORDEN</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>ARICA Y PARINACOTA</td>
      <td>15.0</td>
      <td>ARICA</td>
      <td>151.0</td>
      <td>ARICA</td>
      <td>15101.0</td>
      <td>62129.0</td>
      <td>4574.0</td>
      <td>4045.0</td>
      <td>1666.0</td>
      <td>225.0</td>
      <td>72639.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ARICA Y PARINACOTA</td>
      <td>15.0</td>
      <td>ARICA</td>
      <td>151.0</td>
      <td>CAMARONES</td>
      <td>15102.0</td>
      <td>431.0</td>
      <td>96.0</td>
      <td>158.0</td>
      <td>242.0</td>
      <td>21.0</td>
      <td>948.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ARICA Y PARINACOTA</td>
      <td>15.0</td>
      <td>PARINACOTA</td>
      <td>152.0</td>
      <td>PUTRE</td>
      <td>15201.0</td>
      <td>540.0</td>
      <td>197.0</td>
      <td>143.0</td>
      <td>995.0</td>
      <td>42.0</td>
      <td>1917.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ARICA Y PARINACOTA</td>
      <td>15.0</td>
      <td>PARINACOTA</td>
      <td>152.0</td>
      <td>GENERAL LAGOS</td>
      <td>15202.0</td>
      <td>218.0</td>
      <td>90.0</td>
      <td>162.0</td>
      <td>216.0</td>
      <td>11.0</td>
      <td>697.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TARAPACÁ</td>
      <td>1.0</td>
      <td>IQUIQUE</td>
      <td>11.0</td>
      <td>IQUIQUE</td>
      <td>1101.0</td>
      <td>56007.0</td>
      <td>3673.0</td>
      <td>5481.0</td>
      <td>1564.0</td>
      <td>261.0</td>
      <td>66986.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="multi-indices">
<h2><span class="section-number">11.1. </span>Multi-índices<a class="headerlink" href="#multi-indices" title="Permalink to this heading">#</a></h2>
<p>Estudiando la tabla anterior notamos que tiene una estructura jerárquica</p>
<blockquote>
<div><p>REGIÓN, PROVINCIA, COMUNA</p>
</div></blockquote>
<p>Podemos representar este tipo de estructuras en pandas usando un <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></p>
<p><strong>Asignar y reestablecer índices en un DataFrame</strong></p>
<p>Para asignar un índice a un DataFrame que ya está creado podemos usar el atributo</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="c1"># Una etiqueta o una lista de etiquetas que serán los nuevos índices</span>
             <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># Eliminar las columnas que pasarán a ser índices</span>
             <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># Retornar un nuevo dataframe o modificar df</span>
             <span class="o">...</span>
            <span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<ul class="simple">
<li><p>Si keys es una etiqueta crearemos un índice regular</p></li>
<li><p>Si keys es una lista crearemos un <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></p></li>
</ul>
</div>
<p>Si queremos que nuestro índice o multi-índice vuelva a convertirse en columna podemos usar el atributo</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Permite especificar cuantos niveles de índices se removeran</span>
               <span class="n">drop</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># Si los índices se deben eliminar o agregar como columnas</span>
               <span class="n">inplace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Retornar un nuevo dataframe o modificar df</span>
               <span class="o">...</span>
               <span class="p">)</span>
</pre></div>
</div>
<p><strong>Ejemplo</strong></p>
<p>Crearemos un <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> para la tabla anterior. En este caso usaremos tres niveles de jerarquía:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;NOMBRE REGIÓN&quot;</span><span class="p">,</span> <span class="s2">&quot;NOMBRE PROVINCIA&quot;</span><span class="p">,</span> <span class="s2">&quot;NOMBRE COMUNA&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Si inspeccionamos el DataFrame veremos que:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>Código Región</th>
      <th>Código Provincia</th>
      <th>Código Comuna</th>
      <th>Viviendas Particulares Ocupadas con Moradores Presentes</th>
      <th>Viviendas Particulares Ocupadas con Moradores Ausentes</th>
      <th>Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)</th>
      <th>Viviendas Particulares Desocupadas\n(de Temporada)</th>
      <th>Viviendas Colectivas</th>
      <th>TOTAL VIVIENDAS</th>
    </tr>
    <tr>
      <th>NOMBRE REGIÓN</th>
      <th>NOMBRE PROVINCIA</th>
      <th>NOMBRE COMUNA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="4" valign="top">ARICA Y PARINACOTA</th>
      <th rowspan="2" valign="top">ARICA</th>
      <th>ARICA</th>
      <td>15.0</td>
      <td>151.0</td>
      <td>15101.0</td>
      <td>62129.0</td>
      <td>4574.0</td>
      <td>4045.0</td>
      <td>1666.0</td>
      <td>225.0</td>
      <td>72639.0</td>
    </tr>
    <tr>
      <th>CAMARONES</th>
      <td>15.0</td>
      <td>151.0</td>
      <td>15102.0</td>
      <td>431.0</td>
      <td>96.0</td>
      <td>158.0</td>
      <td>242.0</td>
      <td>21.0</td>
      <td>948.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">PARINACOTA</th>
      <th>PUTRE</th>
      <td>15.0</td>
      <td>152.0</td>
      <td>15201.0</td>
      <td>540.0</td>
      <td>197.0</td>
      <td>143.0</td>
      <td>995.0</td>
      <td>42.0</td>
      <td>1917.0</td>
    </tr>
    <tr>
      <th>GENERAL LAGOS</th>
      <td>15.0</td>
      <td>152.0</td>
      <td>15202.0</td>
      <td>218.0</td>
      <td>90.0</td>
      <td>162.0</td>
      <td>216.0</td>
      <td>11.0</td>
      <td>697.0</td>
    </tr>
    <tr>
      <th>TARAPACÁ</th>
      <th>IQUIQUE</th>
      <th>IQUIQUE</th>
      <td>1.0</td>
      <td>11.0</td>
      <td>1101.0</td>
      <td>56007.0</td>
      <td>3673.0</td>
      <td>5481.0</td>
      <td>1564.0</td>
      <td>261.0</td>
      <td>66986.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">MAGALLANES Y DE LA ANTÁRTICA CHILENA</th>
      <th rowspan="3" valign="top">TIERRA DEL FUEGO</th>
      <th>PORVENIR</th>
      <td>12.0</td>
      <td>123.0</td>
      <td>12301.0</td>
      <td>2097.0</td>
      <td>57.0</td>
      <td>462.0</td>
      <td>511.0</td>
      <td>60.0</td>
      <td>3187.0</td>
    </tr>
    <tr>
      <th>PRIMAVERA</th>
      <td>12.0</td>
      <td>123.0</td>
      <td>12302.0</td>
      <td>190.0</td>
      <td>47.0</td>
      <td>62.0</td>
      <td>100.0</td>
      <td>73.0</td>
      <td>472.0</td>
    </tr>
    <tr>
      <th>TIMAUKEL</th>
      <td>12.0</td>
      <td>123.0</td>
      <td>12303.0</td>
      <td>87.0</td>
      <td>9.0</td>
      <td>34.0</td>
      <td>76.0</td>
      <td>8.0</td>
      <td>214.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">ÚLTIMA ESPERANZA</th>
      <th>NATALES</th>
      <td>12.0</td>
      <td>124.0</td>
      <td>12401.0</td>
      <td>7274.0</td>
      <td>754.0</td>
      <td>900.0</td>
      <td>331.0</td>
      <td>110.0</td>
      <td>9369.0</td>
    </tr>
    <tr>
      <th>TORRES DEL PAINE</th>
      <td>12.0</td>
      <td>124.0</td>
      <td>12402.0</td>
      <td>127.0</td>
      <td>16.0</td>
      <td>7.0</td>
      <td>38.0</td>
      <td>38.0</td>
      <td>226.0</td>
    </tr>
  </tbody>
</table>
<p>346 rows × 9 columns</p>
</div></div></div>
</div>
<p><strong><em>Slicing</em> con <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code></strong></p>
<p>Para recuperar un elemento de un DataFrame con <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> podemos indexar usando una tupla especificando cada uno de los niveles de índices, por ejemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s2">&quot;LOS RÍOS&quot;</span><span class="p">,</span> <span class="s2">&quot;VALDIVIA&quot;</span><span class="p">,</span> <span class="s2">&quot;VALDIVIA&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Código Región                                                                         14.0
Código Provincia                                                                     141.0
Código Comuna                                                                      14101.0
Viviendas Particulares Ocupadas con Moradores Presentes                            53624.0
Viviendas Particulares Ocupadas con Moradores Ausentes                              2939.0
Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)     2876.0
Viviendas Particulares Desocupadas\n(de Temporada)                                  1516.0
Viviendas Colectivas                                                                 237.0
TOTAL VIVIENDAS                                                                    61192.0
Name: (LOS RÍOS, VALDIVIA, VALDIVIA), dtype: float64
</pre></div>
</div>
</div>
</div>
<p>retorna la comuna de Valdivia, mientras que:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s2">&quot;LOS RÍOS&quot;</span><span class="p">,</span> <span class="s2">&quot;VALDIVIA&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_35404/853128477.py:1: PerformanceWarning: indexing past lexsort depth may impact performance.
  df.loc[(&quot;LOS RÍOS&quot;, &quot;VALDIVIA&quot;)]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Código Región</th>
      <th>Código Provincia</th>
      <th>Código Comuna</th>
      <th>Viviendas Particulares Ocupadas con Moradores Presentes</th>
      <th>Viviendas Particulares Ocupadas con Moradores Ausentes</th>
      <th>Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)</th>
      <th>Viviendas Particulares Desocupadas\n(de Temporada)</th>
      <th>Viviendas Colectivas</th>
      <th>TOTAL VIVIENDAS</th>
    </tr>
    <tr>
      <th>NOMBRE COMUNA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>VALDIVIA</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14101.0</td>
      <td>53624.0</td>
      <td>2939.0</td>
      <td>2876.0</td>
      <td>1516.0</td>
      <td>237.0</td>
      <td>61192.0</td>
    </tr>
    <tr>
      <th>CORRAL</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14102.0</td>
      <td>1842.0</td>
      <td>93.0</td>
      <td>158.0</td>
      <td>470.0</td>
      <td>11.0</td>
      <td>2574.0</td>
    </tr>
    <tr>
      <th>LANCO</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14103.0</td>
      <td>5643.0</td>
      <td>265.0</td>
      <td>308.0</td>
      <td>217.0</td>
      <td>17.0</td>
      <td>6450.0</td>
    </tr>
    <tr>
      <th>LOS LAGOS</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14104.0</td>
      <td>6446.0</td>
      <td>304.0</td>
      <td>601.0</td>
      <td>539.0</td>
      <td>23.0</td>
      <td>7913.0</td>
    </tr>
    <tr>
      <th>MÁFIL</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14105.0</td>
      <td>2317.0</td>
      <td>152.0</td>
      <td>161.0</td>
      <td>77.0</td>
      <td>5.0</td>
      <td>2712.0</td>
    </tr>
    <tr>
      <th>MARIQUINA</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14106.0</td>
      <td>6808.0</td>
      <td>351.0</td>
      <td>519.0</td>
      <td>727.0</td>
      <td>12.0</td>
      <td>8417.0</td>
    </tr>
    <tr>
      <th>PAILLACO</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14107.0</td>
      <td>6476.0</td>
      <td>363.0</td>
      <td>542.0</td>
      <td>222.0</td>
      <td>23.0</td>
      <td>7626.0</td>
    </tr>
    <tr>
      <th>PANGUIPULLI</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14108.0</td>
      <td>11615.0</td>
      <td>840.0</td>
      <td>1155.0</td>
      <td>3142.0</td>
      <td>58.0</td>
      <td>16810.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>retorna todas las comunas de la provincia de Valdivia.</p>
<p>Para hacer <em>slices</em> o <code class="docutils literal notranslate"><span class="pre">fancy</span> <span class="pre">indexing</span></code> lo más simple es usar el objeto <a class="reference external" href="https://pandas.pydata.org/pandas-docs/version/0.23.4/generated/pandas.IndexSlice.html"><code class="docutils literal notranslate"><span class="pre">IndexSlice</span></code></a>, por ejemplo:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">[</span><span class="s2">&quot;VALDIVIA&quot;</span><span class="p">,</span> <span class="s2">&quot;OSORNO&quot;</span><span class="p">]],</span> <span class="p">:]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>Código Región</th>
      <th>Código Provincia</th>
      <th>Código Comuna</th>
      <th>Viviendas Particulares Ocupadas con Moradores Presentes</th>
      <th>Viviendas Particulares Ocupadas con Moradores Ausentes</th>
      <th>Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)</th>
      <th>Viviendas Particulares Desocupadas\n(de Temporada)</th>
      <th>Viviendas Colectivas</th>
      <th>TOTAL VIVIENDAS</th>
    </tr>
    <tr>
      <th>NOMBRE REGIÓN</th>
      <th>NOMBRE PROVINCIA</th>
      <th>NOMBRE COMUNA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>LOS RÍOS</th>
      <th>VALDIVIA</th>
      <th>VALDIVIA</th>
      <td>14.0</td>
      <td>141.0</td>
      <td>14101.0</td>
      <td>53624.0</td>
      <td>2939.0</td>
      <td>2876.0</td>
      <td>1516.0</td>
      <td>237.0</td>
      <td>61192.0</td>
    </tr>
    <tr>
      <th>LOS LAGOS</th>
      <th>OSORNO</th>
      <th>OSORNO</th>
      <td>10.0</td>
      <td>103.0</td>
      <td>10301.0</td>
      <td>53821.0</td>
      <td>3082.0</td>
      <td>2685.0</td>
      <td>471.0</td>
      <td>73.0</td>
      <td>60132.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>retorna las comunas de Valdivia y Osorno, sin importar que estén en distintas provincias, mientras que:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IndexSlice</span>
<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;LLANQUIHUE&quot;</span><span class="p">,</span> <span class="s2">&quot;PALENA&quot;</span><span class="p">],</span> <span class="p">:</span> <span class="p">],</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>Código Región</th>
      <th>Código Provincia</th>
      <th>Código Comuna</th>
      <th>Viviendas Particulares Ocupadas con Moradores Presentes</th>
      <th>Viviendas Particulares Ocupadas con Moradores Ausentes</th>
      <th>Viviendas Particulares Desocupadas (en Venta, para arriendo, Abandonada u otro)</th>
      <th>Viviendas Particulares Desocupadas\n(de Temporada)</th>
      <th>Viviendas Colectivas</th>
      <th>TOTAL VIVIENDAS</th>
    </tr>
    <tr>
      <th>NOMBRE REGIÓN</th>
      <th>NOMBRE PROVINCIA</th>
      <th>NOMBRE COMUNA</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="13" valign="top">LOS LAGOS</th>
      <th rowspan="9" valign="top">LLANQUIHUE</th>
      <th>PUERTO MONTT</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10101.0</td>
      <td>78820.0</td>
      <td>5503.0</td>
      <td>6655.0</td>
      <td>2194.0</td>
      <td>208.0</td>
      <td>93380.0</td>
    </tr>
    <tr>
      <th>CALBUCO</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10102.0</td>
      <td>11146.0</td>
      <td>745.0</td>
      <td>1006.0</td>
      <td>637.0</td>
      <td>36.0</td>
      <td>13570.0</td>
    </tr>
    <tr>
      <th>COCHAMÓ</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10103.0</td>
      <td>1600.0</td>
      <td>90.0</td>
      <td>172.0</td>
      <td>358.0</td>
      <td>20.0</td>
      <td>2240.0</td>
    </tr>
    <tr>
      <th>FRESIA</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10104.0</td>
      <td>4356.0</td>
      <td>236.0</td>
      <td>435.0</td>
      <td>227.0</td>
      <td>8.0</td>
      <td>5262.0</td>
    </tr>
    <tr>
      <th>FRUTILLAR</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10105.0</td>
      <td>6267.0</td>
      <td>626.0</td>
      <td>594.0</td>
      <td>398.0</td>
      <td>24.0</td>
      <td>7909.0</td>
    </tr>
    <tr>
      <th>LOS MUERMOS</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10106.0</td>
      <td>5990.0</td>
      <td>327.0</td>
      <td>619.0</td>
      <td>321.0</td>
      <td>7.0</td>
      <td>7264.0</td>
    </tr>
    <tr>
      <th>LLANQUIHUE</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10107.0</td>
      <td>5550.0</td>
      <td>200.0</td>
      <td>258.0</td>
      <td>115.0</td>
      <td>12.0</td>
      <td>6135.0</td>
    </tr>
    <tr>
      <th>MAULLÍN</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10108.0</td>
      <td>5112.0</td>
      <td>259.0</td>
      <td>743.0</td>
      <td>502.0</td>
      <td>14.0</td>
      <td>6630.0</td>
    </tr>
    <tr>
      <th>PUERTO VARAS</th>
      <td>10.0</td>
      <td>101.0</td>
      <td>10109.0</td>
      <td>14231.0</td>
      <td>1034.0</td>
      <td>1168.0</td>
      <td>1108.0</td>
      <td>102.0</td>
      <td>17643.0</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">PALENA</th>
      <th>CHAITÉN</th>
      <td>10.0</td>
      <td>104.0</td>
      <td>10401.0</td>
      <td>1625.0</td>
      <td>151.0</td>
      <td>195.0</td>
      <td>190.0</td>
      <td>60.0</td>
      <td>2221.0</td>
    </tr>
    <tr>
      <th>FUTALEUFÚ</th>
      <td>10.0</td>
      <td>104.0</td>
      <td>10402.0</td>
      <td>1002.0</td>
      <td>130.0</td>
      <td>101.0</td>
      <td>176.0</td>
      <td>24.0</td>
      <td>1433.0</td>
    </tr>
    <tr>
      <th>HUALAIHUÉ</th>
      <td>10.0</td>
      <td>104.0</td>
      <td>10403.0</td>
      <td>3093.0</td>
      <td>270.0</td>
      <td>616.0</td>
      <td>439.0</td>
      <td>21.0</td>
      <td>4439.0</td>
    </tr>
    <tr>
      <th>PALENA</th>
      <td>10.0</td>
      <td>104.0</td>
      <td>10404.0</td>
      <td>715.0</td>
      <td>61.0</td>
      <td>58.0</td>
      <td>165.0</td>
      <td>3.0</td>
      <td>1002.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>retorna las comunas pertenecientes a las provincias de Llanquihue y Palena</p>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<p>Con IndexSlice podemos recuperar subconjuntos arbitrarios de filas en base al índice jerárquico</p>
</div>
</section>
<section id="patron-split-apply-combine-en-dataframes">
<h2><span class="section-number">11.2. </span>Patrón <em>Split-Apply-Combine</em> en DataFrames<a class="headerlink" href="#patron-split-apply-combine-en-dataframes" title="Permalink to this heading">#</a></h2>
<p>Digamos que queremos obtener los totales de todos los tipos de vivienda a nivel de provincia</p>
<p>Si asignamos “NOMBRE PROVINCIA” como índice podríamos usar</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">provincia</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>    
    <span class="n">sub_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">provincia</span><span class="p">,</span> <span class="n">col_mask</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>    
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">provincia</span><span class="p">,</span> <span class="n">col_mask</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># No hacer reducción suma si la provincia tiene una sola comuna</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">provincia</span><span class="p">,</span> <span class="n">col_mask</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">col_mask</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
<p>que obtiene el resultado deseado, pero es ineficiente y bastante engorroso</p>
<p>El ejemplo anterior representa un patrón de “operaciones condicionadas por llave” que es muy utilizado en bases de datos y se conoce como <em>split-apply-combine</em></p>
<img alt="../../_images/groupby.svg" src="../../_images/groupby.svg" /><p>Donde</p>
<ul class="simple">
<li><p><em>split</em>: Divide los datos según una <strong>llave</strong></p></li>
<li><p><em>apply</em>: Realiza una función sobre cada grupo</p></li>
<li><p><em>combine</em>: Mezcla el resultado en un nuevo dataframe donde la <strong>llave</strong> se convierte en el índice</p></li>
</ul>
<p>En el ejemplo anterior</p>
<ul class="simple">
<li><p><em>split</em>: Crea subconjuntos con las comunas de cada provincia</p></li>
<li><p><em>apply</em>: Hace una reducción suma en las columnas de viviendas</p></li>
<li><p><em>combine</em>: Construye un nuevo dataframe con los resultados donde la llave son las provincias</p></li>
</ul>
<section id="atributo-groupby">
<h3><span class="section-number">11.2.1. </span>Atributo <code class="docutils literal notranslate"><span class="pre">groupby</span></code><a class="headerlink" href="#atributo-groupby" title="Permalink to this heading">#</a></h3>
<p>El patrón <em>split-apply-combine</em> está implementado de forma muy eficiente en <code class="docutils literal notranslate"><span class="pre">pandas</span></code> a través del atributo <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html"><code class="docutils literal notranslate"><span class="pre">groupby()</span></code></a></p>
<p>Los argumentos básicos de <code class="docutils literal notranslate"><span class="pre">groupby</span></code> son</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># Columna o lista de columnas con se hace el split</span>
           <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># Dividir en filas (0) o en columnas (1)</span>
           <span class="n">as_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Retornar las etiquetas de cada grupo como índice</span>
           <span class="n">sort</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Retornar las etiquetas de grupo ordenadas alfabeticamente</span>
           <span class="o">...</span>
          <span class="p">)</span>    
</pre></div>
</div>
<p>Notemos que <code class="docutils literal notranslate"><span class="pre">groupby</span></code> actua como un iterador</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">sub_df</span><span class="p">)</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;NOMBRE REGIÓN&#39;</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="c1"># La etiqueta</span>
            <span class="n">sub_df</span>  <span class="c1"># El dataframe con las filas que comparten esa etiqueta</span>
           <span class="p">)</span>
</pre></div>
</div>
<p>La función que se ejecuta a cada grupo en el paso <em>apply</em> es un atributo de <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, existen cuatro atributos</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aggregate</span></code>: Para hacer reducciones</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filter</span></code>: Para eliminar filas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transform</span></code>: Para modificar filas</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">apply</span></code>: Función flexible que puede combinar lo que hace <code class="docutils literal notranslate"><span class="pre">aggregate</span></code> y <code class="docutils literal notranslate"><span class="pre">transform</span></code></p></li>
</ul>
<p>A continuación revisaremos las primeras tres en detalle</p>
</section>
<section id="reduccion-con-aggregate">
<h3><span class="section-number">11.2.2. </span>Reducción con <code class="docutils literal notranslate"><span class="pre">aggregate</span></code><a class="headerlink" href="#reduccion-con-aggregate" title="Permalink to this heading">#</a></h3>
<p>La sintaxis básica de este atributo es</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Para aplicar la misma función a todos las columnas</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">llave</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">funcion1</span><span class="p">)</span> 
<span class="c1"># Para aplicar varias funciones a todos las columnas</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">llave</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">([</span><span class="n">funcion1</span><span class="p">,</span> <span class="n">funcion2</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> 
<span class="c1"># Para aplicar funciones específicas a columnas específicas</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">llave</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">({</span><span class="n">columna1</span><span class="p">:</span> <span class="n">funcion1</span><span class="p">,</span> <span class="n">columna2</span><span class="p">:</span> <span class="n">funcion2</span><span class="p">})</span> 
</pre></div>
</div>
<p>Las funciones debe entregar un sólo valor por cada columna del grupo</p>
<p>En general las reducciones se usan para hacer resumenes, por ejemplo sumas, promedios o varianzas</p>
<p><strong>Ejemplo</strong></p>
<p>Podemos encontrar los totales de vivienda por provincia en una sola linea usando</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;NOMBRE PROVINCIA&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
</pre></div>
</div>
<p>O usando el alias</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;NOMBRE PROVINCIA&quot;</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
</pre></div>
</div>
</section>
<section id="filtrado-con-filter">
<h3><span class="section-number">11.2.3. </span>Filtrado con <code class="docutils literal notranslate"><span class="pre">filter</span></code><a class="headerlink" href="#filtrado-con-filter" title="Permalink to this heading">#</a></h3>
<p>La sintaxis básica de este atributo es</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">llave</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">funcion</span><span class="p">)</span>
</pre></div>
</div>
<p>La función debe retornar <code class="docutils literal notranslate"><span class="pre">True</span></code> o <code class="docutils literal notranslate"><span class="pre">False</span></code></p>
<p>El resultado es un nuevo DataFrame con todos los grupos que “pasaron el filtro”</p>
<p>En general este atributo se usa para eliminar/descartar grupos de filas (drop)</p>
</section>
<section id="modificando-el-dataframe-con-transform">
<h3><span class="section-number">11.2.4. </span>Modificando el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> con <code class="docutils literal notranslate"><span class="pre">transform</span></code><a class="headerlink" href="#modificando-el-dataframe-con-transform" title="Permalink to this heading">#</a></h3>
<p>La sintaxis básica de este atributo es</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">llave</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">funcion</span><span class="p">)</span>
</pre></div>
</div>
<p>La función debe retornar un dataframe con la misma dimensión y tamaño que el original y se aplica columna a columna</p>
<p>La función puede ser explicita o anónima (lambda)</p>
<p>Un uso típico de este atributo es el reescalamiento/normalización a nivel de grupo</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./contents/pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="part2.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title"><span class="section-number">10. </span>Importar y exportar datos</p>
      </div>
    </a>
    <a class="right-next"
       href="part4.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Tópicos extra</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-indices">11.1. Multi-índices</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patron-split-apply-combine-en-dataframes">11.2. Patrón <em>Split-Apply-Combine</em> en DataFrames</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atributo-groupby">11.2.1. Atributo <code class="docutils literal notranslate"><span class="pre">groupby</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reduccion-con-aggregate">11.2.2. Reducción con <code class="docutils literal notranslate"><span class="pre">aggregate</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtrado-con-filter">11.2.3. Filtrado con <code class="docutils literal notranslate"><span class="pre">filter</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modificando-el-dataframe-con-transform">11.2.4. Modificando el <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> con <code class="docutils literal notranslate"><span class="pre">transform</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por Pablo Huijse Heise
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>